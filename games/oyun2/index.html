<!DOCTYPE html>
<html lang="tr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8567873693670598"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hayvan HafÄ±za Oyunu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* ANDROID OPTÄ°MÄ°ZASYONLARI */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0fdf4;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            overflow: hidden;
            touch-action: none;
        }

        button, select { touch-action: manipulation; }

        .card-container {
            perspective: 1000px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.4s;
            transform-style: preserve-3d;
            will-change: transform;
        }

        .card-container.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .card-front {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            font-size: 1.5rem;
        }

        .card-back {
            background-color: white;
            border: 2px solid #4ade80;
            transform: rotateY(180deg);
        }

        .game-grid {
            display: grid;
            max-width: 100%;
            margin: 0 auto;
        }

        .player-active {
            border: 3px solid #facc15;
            background-color: #dcfce7;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.6);
        }

        .ad-banner {
            width: 100%;
            height: 50px;
            background-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
    </style>
</head>
<body class="flex flex-col h-screen">
<a href="../../index.html">â¬… Ana MenÃ¼</a>

<div id="ad-banner-top" class="ad-banner flex-shrink-0"></div>

<!-- Ãœst MenÃ¼ -->
<div class="flex-shrink-0 px-4 pt-2 pb-1 z-20 w-full max-w-2xl mx-auto flex justify-start items-center">
    <button onclick="SoundManager.playClick(); Game.restartGame()" class="flex items-center gap-2 bg-white text-green-700 px-4 py-2 rounded-full shadow-sm hover:bg-green-50 active:scale-95 transition text-sm font-bold border border-green-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        <span>Ana MenÃ¼</span>
    </button>
</div>

<!-- Skor Tablosu -->
<div class="flex-shrink-0 px-2 pb-2 z-10">
    <div class="flex justify-between items-center max-w-2xl mx-auto bg-white p-2 rounded-xl shadow-sm border border-green-100">
        <div id="p1-panel" class="player-panel flex flex-col items-center p-2 rounded-lg transition-all duration-300 w-1/3">
            <span class="font-bold text-gray-700 text-sm md:text-base">Oyuncu 1</span>
            <span id="score-p1" class="text-2xl font-bold text-green-600">0</span>
        </div>

        <div class="flex flex-col items-center w-1/6">
            <span class="text-xs text-gray-300 font-bold italic text-2xl">VS</span>
        </div>

        <div id="p2-panel" class="player-panel flex flex-col items-center p-2 rounded-lg transition-all duration-300 w-1/3">
            <span class="font-bold text-gray-700 text-sm md:text-base">Oyuncu 2</span>
            <span id="score-p2" class="text-2xl font-bold text-blue-600">0</span>
        </div>
    </div>
</div>

<!-- Oyun AlanÄ± -->
<div class="flex-grow overflow-y-auto p-2 bg-green-50 flex items-center justify-center" style="touch-action: pan-y;">
    <div id="game-board" class="game-grid w-full max-w-3xl pb-4"></div>
</div>

<!-- MenÃ¼ EkranÄ± -->
<div id="menu-screen" class="absolute inset-0 bg-green-600 z-50 flex flex-col items-center justify-center text-white">
    <h1 class="text-4xl font-bold mb-2 text-yellow-300 drop-shadow-md">Hayvan HafÄ±za</h1>
    <p class="mb-8 opacity-80 text-sm">EÅŸini Bul, PuanÄ± Kap!</p>

    <div class="bg-white p-6 rounded-xl shadow-2xl w-80 text-center relative">
        <h2 class="text-gray-700 font-bold mb-4 text-lg">Zorluk SeÃ§</h2>

        <button onclick="SoundManager.init(); SoundManager.playClick(); Game.start(1)" class="w-full bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold py-3 rounded-lg mb-3 transition transform active:scale-95 shadow-md border-b-4 border-green-700">
            KOLAY (20 Kart)
        </button>
        <button onclick="SoundManager.init(); SoundManager.playClick(); Game.start(2)" class="w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-bold py-3 rounded-lg mb-3 transition transform active:scale-95 shadow-md border-b-4 border-blue-700">
            ORTA (30 Kart)
        </button>
        <button onclick="SoundManager.init(); SoundManager.playClick(); Game.start(3)" class="w-full bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white font-bold py-3 rounded-lg transition transform active:scale-95 shadow-md border-b-4 border-purple-700">
            ZOR (40 Kart)
        </button>
    </div>
</div>

<!-- Oyun Bitti EkranÄ± -->
<div id="game-over-screen" class="hidden absolute inset-0 bg-black bg-opacity-80 z-40 flex flex-col items-center justify-center text-white">
    <div class="bg-white text-gray-800 p-8 rounded-2xl text-center shadow-2xl animate-bounce-in max-w-sm mx-4">
        <h2 class="text-3xl font-bold mb-2">Oyun Bitti! ğŸ†</h2>
        <div id="winner-text" class="text-xl font-semibold text-green-600 mb-6">
            Kazanan: Oyuncu 1
        </div>

        <div class="flex justify-center space-x-8 mb-6 text-sm">
            <div class="flex flex-col">
                <span class="text-gray-500">Oyuncu 1</span>
                <span id="final-score-p1" class="text-2xl font-bold">0</span>
            </div>
            <div class="flex flex-col">
                <span class="text-gray-500">Oyuncu 2</span>
                <span id="final-score-p2" class="text-2xl font-bold">0</span>
            </div>
        </div>

        <button onclick="SoundManager.playClick(); Game.showMenu()" class="w-full bg-yellow-400 hover:bg-yellow-500 active:bg-yellow-600 text-yellow-900 font-bold py-3 rounded-lg shadow-md border-b-4 border-yellow-600 active:scale-95 transform transition">
            TEKRAR OYNA
        </button>
    </div>
</div>

<div id="ad-banner-bottom" class="ad-banner flex-shrink-0"></div>

<script>
    const SoundManager = {
        ctx: null,

        init: function() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!this.ctx) { this.ctx = new AudioContext(); }
                if (this.ctx.state === 'suspended') { this.ctx.resume(); }
            } catch(e) { console.error("Ses hatasÄ±:", e); }
        },

        playTone: function(freq, type, duration, startTime = 0, vol = 0.1) {
            if (!this.ctx) return;
            try {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime + startTime);
                const now = this.ctx.currentTime + startTime;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(vol, now + (duration * 0.1));
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start(now);
                osc.stop(now + duration);
            } catch(e) {}
        },
        playClick: function() { this.playTone(1200, 'sine', 0.05, 0, 0.05); },
        playFlip: function() { this.playTone(500, 'sine', 0.15, 0, 0.15); },
        playMatch: function() {
            this.playTone(523.25, 'sine', 0.4, 0, 0.1);
            this.playTone(659.25, 'sine', 0.4, 0.1, 0.1);
            this.playTone(783.99, 'sine', 0.6, 0.2, 0.1);
        },
        playMismatch: function() { this.playTone(200, 'triangle', 0.3, 0, 0.1); },
        playWin: function() {
            this.playTone(523.25, 'triangle', 0.2, 0, 0.1);
            this.playTone(659.25, 'triangle', 0.2, 0.15, 0.1);
            this.playTone(783.99, 'triangle', 0.2, 0.30, 0.1);
            this.playTone(1046.50, 'triangle', 0.6, 0.45, 0.2);
        }
    };

    const AndroidBridge = {
        showInterstitial: function() { if (typeof Android !== "undefined" && Android.showInterstitial) Android.showInterstitial(); },
        showBanner: function() { if (typeof Android !== "undefined" && Android.showBanner) Android.showBanner(); }
    };

    const Game = {
        state: { cards: [], flippedCards: [], matchedPairs: 0, totalPairs: 0, currentPlayer: 1, scores: { 1: 0, 2: 0 }, isLocked: false, difficulty: 1 },
        config: {
            easy: { 
                pairs: 10, 
                cols: 'grid-cols-4', 
                mobileCols: 'grid-cols-4', 
                gap: 'gap-2',
                cardHeight: 'h-16 md:h-24', 
                fontSize: 'text-2xl md:text-4xl'
            },
            medium: { 
                pairs: 15, 
                cols: 'grid-cols-6', 
                mobileCols: 'grid-cols-5', 
                gap: 'gap-2',
                cardHeight: 'h-14 md:h-20', 
                fontSize: 'text-xl md:text-3xl'
            },
            hard: { 
                pairs: 20, 
                cols: 'grid-cols-8', 
                mobileCols: 'grid-cols-5', 
                gap: 'gap-1', 
                cardHeight: 'h-12 md:h-16', 
                fontSize: 'text-lg md:text-2xl'
            }
        },
        animals: ['ğŸ¦', 'ğŸ¯', 'ğŸ»', 'ğŸ¨', 'ğŸ¼', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ', 'ğŸœ'],

        start: function(difficultyLevel) {
            SoundManager.init();
            AndroidBridge.showBanner();

            this.state.difficulty = difficultyLevel;
            this.resetState();

            let config = (difficultyLevel === 1) ? this.config.easy : (difficultyLevel === 2) ? this.config.medium : this.config.hard;
            this.state.totalPairs = config.pairs;

            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            this.generateCards(config);
            this.updateUI();
        },

        resetState: function() {
            this.state.scores = { 1: 0, 2: 0 };
            this.state.currentPlayer = 1;
            this.state.matchedPairs = 0;
            this.state.flippedCards = [];
            this.state.isLocked = false;
        },

        generateCards: function(config) {
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = '';
            const isMobile = window.innerWidth < 768;
            gameBoard.className = `game-grid w-full max-w-4xl mx-auto ${config.gap} ` + (isMobile ? config.mobileCols : config.cols);

            const selectedAnimals = this.animals.slice(0, config.pairs);
            const deck = [...selectedAnimals, ...selectedAnimals];
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }

            deck.forEach((animal, index) => {
                const card = document.createElement('div');
                card.className = `card-container ${config.cardHeight} select-none`;
                card.dataset.id = index;
                card.dataset.animal = animal;
                card.innerHTML = `<div class="card-inner w-full h-full"><div class="card-front flex items-center justify-center text-white rounded-lg"><span class="opacity-30 text-xs font-bold">?</span></div><div class="card-back flex items-center justify-center ${config.fontSize} bg-white border-2 border-green-400 rounded-lg">${animal}</div></div>`;
                card.addEventListener('click', () => this.handleCardClick(card));
                gameBoard.appendChild(card);
            });
        },

        handleCardClick: function(card) {
            if (this.state.isLocked || card.classList.contains('flipped') || card.classList.contains('matched')) return;
            SoundManager.playFlip();
            this.flipCard(card);
            this.state.flippedCards.push(card);
            if (this.state.flippedCards.length === 2) { this.checkForMatch(); }
        },

        flipCard: function(card) { card.classList.add('flipped'); },
        unflipCard: function(card) { card.classList.remove('flipped'); },

        checkForMatch: function() {
            this.state.isLocked = true;
            const [card1, card2] = this.state.flippedCards;
            if (card1.dataset.animal === card2.dataset.animal) { this.handleMatch(card1, card2); }
            else { this.handleMismatch(card1, card2); }
        },

        handleMatch: function(card1, card2) {
            this.state.scores[this.state.currentPlayer]++;
            this.state.matchedPairs++;
            SoundManager.playMatch();
            setTimeout(() => {
                card1.classList.add('matched', 'opacity-50');
                card2.classList.add('matched', 'opacity-50');
                card1.querySelector('.card-back').style.backgroundColor = '#dcfce7';
                card2.querySelector('.card-back').style.backgroundColor = '#dcfce7';
                this.state.flippedCards = [];
                this.state.isLocked = false;
                this.updateUI();
                if (this.state.matchedPairs === this.state.totalPairs) { this.endGame(); }
            }, 500);
        },

        handleMismatch: function(card1, card2) {
            SoundManager.playMismatch();
            setTimeout(() => {
                card1.querySelector('.card-back').style.borderColor = '#f87171';
                card2.querySelector('.card-back').style.borderColor = '#f87171';
            }, 200);
            setTimeout(() => {
                this.unflipCard(card1);
                this.unflipCard(card2);
                card1.querySelector('.card-back').style.borderColor = '#4ade80';
                card2.querySelector('.card-back').style.borderColor = '#4ade80';
                this.state.flippedCards = [];
                this.switchTurn();
                this.state.isLocked = false;
            }, 1000);
        },

        switchTurn: function() {
            this.state.currentPlayer = this.state.currentPlayer === 1 ? 2 : 1;
            this.updateUI();
        },

        updateUI: function() {
            document.getElementById('score-p1').textContent = this.state.scores[1];
            document.getElementById('score-p2').textContent = this.state.scores[2];
            const p1Panel = document.getElementById('p1-panel');
            const p2Panel = document.getElementById('p2-panel');
            if (this.state.currentPlayer === 1) {
                p1Panel.classList.add('player-active'); p2Panel.classList.remove('player-active');
                p2Panel.classList.add('opacity-60'); p1Panel.classList.remove('opacity-60');
            } else {
                p2Panel.classList.add('player-active'); p1Panel.classList.remove('player-active');
                p1Panel.classList.add('opacity-60'); p2Panel.classList.remove('opacity-60');
            }
        },

        endGame: function() {
            AndroidBridge.showInterstitial();
            SoundManager.playWin();

            const p1 = this.state.scores[1];
            const p2 = this.state.scores[2];
            let winnerText = (p1 > p2) ? "Kazanan: Oyuncu 1! ğŸ‰" : (p2 > p1) ? "Kazanan: Oyuncu 2! ğŸ‰" : "Beraberlik! ğŸ¤";
            document.getElementById('winner-text').textContent = winnerText;
            document.getElementById('final-score-p1').textContent = p1;
            document.getElementById('final-score-p2').textContent = p2;
            setTimeout(() => { document.getElementById('game-over-screen').classList.remove('hidden'); }, 800);
        },

        showMenu: function() {
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('menu-screen').classList.remove('hidden');
        },

        restartGame: function() { this.showMenu(); }
    };
</script>
</body>
</html>